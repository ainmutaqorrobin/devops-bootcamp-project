# Ansible Configuration

This directory contains Ansible playbooks and roles for configuring the DevOps infrastructure.

## Directory Structure

```
ansible/
├── ansible.cfg          # Ansible configuration
├── inventory.ini        # Server inventory (auto-generated by Terraform)
├── playbook.yml         # Main playbook
├── roles/               # Ansible roles
│   ├── common/          # Basic server setup
│   ├── docker/          # Docker installation
│   ├── webapp/          # Web application deployment
│   └── monitoring/      # Monitoring stack setup
└── README.md           # This file
```

## Important Notes

- **`inventory.ini` is auto-generated** by Terraform (`terraform/ansible.tf`)
- After running `terraform apply`, the inventory file will contain actual IP addresses
- Do not edit `inventory.ini` manually - it will be overwritten by Terraform

## Prerequisites

1. SSH access to all servers (keys should be configured)
2. Ansible installed on your local machine
3. AWS infrastructure deployed via Terraform

## Usage

### 1. Configure SSH Access

Ensure you can SSH to all servers without password prompts:

```bash
ssh ubuntu@<web-server-public-ip>
ssh ubuntu@<ansible-controller-private-ip>
ssh ubuntu@<monitoring-server-private-ip>
```

### 2. Test Connectivity

```bash
ansible all -m ping
```

### 3. Run the Complete Playbook

```bash
ansible-playbook playbook.yml
```

### 4. Run Individual Roles

```bash
# Configure common settings on all servers
ansible-playbook playbook.yml --tags common

# Install Docker on all servers
ansible-playbook playbook.yml --tags docker

# Deploy web application
ansible-playbook playbook.yml --tags webapp

# Setup monitoring
ansible-playbook playbook.yml --tags monitoring
```

## What Gets Configured

- **Common**: Updates packages, installs essentials on all servers
- **Docker**: Installs Docker Engine and Compose on all servers
- **Webapp**: Deploys the application from GitHub as Docker container
- **Monitoring**: Sets up Prometheus and Grafana stack

## Access URLs (after deployment)

- **Web Application**: `http://<web-server-public-ip>`
- **Grafana**: `http://<monitoring-server-private-ip>:3000` (admin/admin)
- **Prometheus**: `http://<monitoring-server-private-ip>:9090`

## Troubleshooting

1. Check SSH connectivity: `ansible all -m ping`
2. View detailed output: `ansible-playbook playbook.yml -v`
3. Run specific tasks: `ansible-playbook playbook.yml --step`
4. Check logs: Check `/var/log/cloud-init-output.log` on servers